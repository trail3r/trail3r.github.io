{%- comment -%} ====================================================================================================
파일(File):
  - _includes/customs/posts-taxonomy.html

역할(Role):
  - 게시글의 카테고리와 태그(taxonomy)를 렌더링합니다.

인자(Argument):
  - (선택사항) post(객체): 카테고리와 태그를 렌더링할 게시글 객체 (기본값: 현재 컨텍스트의 게시글)

참고사항(Notes):
  - Context-aware 링크 동작을 구현합니다.
    - 이미 카테고리 또는 태그 아카이브 페이지에 있으면 중복 탐색을 방지하기 위해 페이지 내 앵커(#slug)로 연결합니다.
    - 카테고리 또는 태그 아카이브 페이지 외부에 있으면 앵커(예: /tags/#slug)를 사용하여 아카이브 페이지로 연결합니다.
  - 태그의 최대 개수를 5개로 제한하고, 초과된 태그의 개수를 "+ N" 형식의 버튼으로 렌더링합니다.
  - 태그의 글자 수 길이를 제한하여 UI 일관성을 유지합니다.
================================================================================================= {%- endcomment -%}


{%- comment -%} 카테고리 또는 태그를 렌더링할 게시글 객체 설정 {%- endcomment -%}
{%- assign post = include.post | default: post -%}

{%- comment -%} 카테고리 아카이브 페이지 URL 정규화 {%- endcomment -%}
{%- assign categories_path = site.category_archive.path | default: "/categories/" | relative_url | replace: "index.html", "" -%}
{%- assign categories_path_trail = categories_path | slice: -1, 1 -%}
{%- unless categories_path_trail == "/" -%} {%- assign categories_path = categories_path | append: "/" -%} {%- endunless -%}

{%- comment -%} 태그 아카이브 페이지 URL 정규화 {%- endcomment -%}
{%- assign tags_path = site.tag_archive.path | default: "/tags/" | relative_url | replace: "index.html", "" -%}
{%- assign tags_path_trail = tags_path | slice: -1, 1 -%}
{%- unless tags_path_trail == "/" -%} {%- assign tags_path = tags_path | append: "/" -%} {%- endunless -%}

{%- comment -%} 현재 페이지가 카테고리 또는 태그 페이지인지 확인 {%- endcomment -%}
{%- assign current_url = page.url | relative_url | replace: "index.html", "" -%}
{%- assign current_url_trail = current_url | slice: -1, 1 -%}
{%- unless current_url_trail == "/" -%} {%- assign current_url = current_url | append: "/" -%} {%- endunless -%}

{%- assign on_categories_path = false -%}
{%- if current_url contains categories_path -%}
  {%- assign on_categories_path = true -%}
{%- endif -%}

{%- assign on_tags_path = false -%}
{%- if current_url contains tags_path -%}
  {%- assign on_tags_path = true -%}
{%- endif -%}



{%- if post -%}
<span class="posts__taxonomy">
  {%- if post.categories and post.categories.size > 0 -%}
    {%- for category in post.categories -%}
      {%- assign category_slug = category | slugify -%}

      {%- if on_categories_path -%}
        {%- assign categories_href = "#" | append: category_slug -%}
      {%- else -%}
        {%- assign categories_href = categories_path | append: "#" | append: category_slug -%}
      {%- endif -%}

      <span class="posts__list posts__category">
        <a href="{{ categories_href }}">{{ category | escape_once }}</a>
      </span>
    {%- endfor -%}
  {%- endif -%}

  {%- assign max_tags = 5 -%}
  {%- assign displayed_tags = 0 -%}

  {%- if post.tags and post.tags.size > 0 -%}
    {%- for tag in post.tags -%}
      {%- assign tag_slug = tag | slugify -%}
      {%- if on_tags_path -%}
        {%- assign tag_href = "#" | append: tag_slug -%}
      {%- else -%}
        {%- assign tag_href = tags_path | append: "#" | append: tag_slug -%}
      {%- endif -%}

      {%- if displayed_tags < max_tags -%}
        <span class="posts__list posts__tag">
          <a href="{{ tag_href }}" title="#{{ tag | escape_once }}">#{{ tag | escape_once }}</a>
        </span>
      {%- else -%}
        <span class="posts__list posts__tag posts__tag--hidden" hidden>
          <a href="{{ tag_href }}" title="#{{ tag | escape_once }}">#{{ tag | escape_once }}</a>
        </span>
      {%- endif -%}

      {%- assign displayed_tags = displayed_tags | plus: 1 -%}
    {%- endfor -%}

    {%- assign hidden_tags = post.tags.size | minus: max_tags -%}
    {%- if hidden_tags > 0 -%}
      <button type="button" class="posts__list posts__tag-hidden posts__tag-expand-btn"
        data-expand-text="+ {{ hidden_tags }}" data-hide-text="접기" aria-expanded="false"> + {{ hidden_tags }}
      </button>
    {%- endif -%}
  {%- endif -%}
</span>
{%- endif -%}